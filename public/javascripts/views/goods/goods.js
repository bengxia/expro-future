var zTree;var zNodes;//保存树节点的json对象var setting = {    async: {        enable: true,        type:"get",        dataType:"text",        contentType:"application/json",        url:"/goods/type",        autoParam:["_id", "name"],        otherParam:{"otherParam":""},//可以传参，暂未使用        dataFilter: filter    },    view: {        dblClickExpand: false,        showLine: true,        selectedMulti: false,        expandSpeed: ($.browser.msie && parseInt($.browser.version)<=6)?"":"fast"    },    data: {        simpleData: {            enable:true,            idKey: "_id",            pIdKey: "parent_id",            rootPId: ""        }    },    callback: {        beforeClick: beforeClick,        onClick: onClick    }};function filter(treeId, parentNode, childNodes) {    if (!childNodes) return null;    for (var i=0, l=childNodes.length; i<l; i++) {        childNodes[i].name = childNodes[i].name.replace(/\.n/g, '.');    }    return childNodes;};function beforeClick(treeId, treeNode) {    //var check = (treeNode && !treeNode.isParent);    //if (!check) alert("只能选择叶子节点...");    //return check;    return true;}function onClick(e, treeId, treeNode) {    zTree = $.fn.zTree.getZTreeObj("treeDemo"),        nodes = zTree.getSelectedNodes(),        v = "";    _id = "";    //nodes.sort(function compare(a,b){return a.id-b.id;});    if(nodes.length){        _id = nodes[0]._id;        v = nodes[0].name;        console.log(_id);        $("#typeId").val(_id);        $("#type_name").val(v);    }    hideMenu();}function showMenu() {    var myObj = $("#type_name");    var myOffset = $("#type_name").offset();    var dialogOffset = $("#goodsDialog").offset();    var left = myOffset.left - dialogOffset.left;    var top = myOffset.top - dialogOffset.top;    $("#menuContent").css({left:left + "px", top:top + myObj.outerHeight() + "px"}).slideDown("fast");    $("body").bind("mousedown", onBodyDown);}function hideMenu() {    $("#menuContent").fadeOut("fast");    $("body").unbind("mousedown", onBodyDown);}function onBodyDown(event) {    if (!(event.target.id == "menuBtn" || event.target.id == "menuContent" || $(event.target).parents("#menuContent").length>0)) {        hideMenu();    }}$(document).ready(function(){    //页面初始化    pageInit();    $.ajax({        type: "Get",        url: '/goods/type',        dataType: "text",        global: false,        async: false,        success: function (strReult) {            zNodes=eval(strReult);        },        error: function () {            alert("Ajax请求数据失败!");        }    });    var t = $("#treeDemo");    t = $.fn.zTree.init(t, setting, zNodes);});$(function(){    $('#add_form').ajaxForm({        beforeSubmit: validate,        success: function(data, status, xhr){            var jsonStr = JSON.stringify(data);            console.log('jsonStr:'+jsonStr+" |status:"+status);            if("success" == status){                $().message("操作成功！");                $.fancybox.close();//为防止因为网络延时造成对话框不关闭，再次输入，提前关闭对话框。                $("#list").trigger("reloadGrid", [{current:true}]);            }else{                $().message("添加失败:"+data.error);            }        }    });    //提交表单进行保存    $("#save").click(function(){        $('#add_form').submit();    });    function validate(formData, jqForm, options) {    };});//页面初始化时调用，设置按钮显示，输入框是否只读等属性。function pageInit(){    // - 新增(pageState=0)： _id 为空，isReadonly=false, 所有输入框为空，显示：保存按钮    // - 查看(pageState=1)： _id不为空，isReadonly=true， 输入框有数据，显示：关闭按钮    // - 编辑(pageState=2)： _id不为空，isReadonly=false， 输入框有数据，显示：保存按钮 + 关闭按钮    /*    if(#{pageState} == 0){        //新增        $("#save").show();        $("#create_time_div").hide();    }else if(#{pageState} == 1){        //查看        $(".allowInput").attr("readonly","readonly");        $("#save").hide();//启动时隐藏保存按钮    }else if(#{pageState} == 2){        //编辑        $("#save").show();//显示save    }*/};