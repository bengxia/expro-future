//设置前台页面显示的表格列头var colNames = ['编号', '昵称', '商户','角色名称','状态','创建时间','到期时间'];//设置前台页面显示的表格数据var colModel = [    {name:'_id',index:'ef_member._id', width:100, align:'center',sortable:true},    {name:'pet_name',index:'pet_name', width:150, align:'center',sortable:false},    {name:'merchant_short_name',index:'merchant_short_name', width:200,align:'center',sortable:false},    {name:'role_name',index:'role_name', width:200, align:'center',sortable:false},    {name:'state',index:'state', width:200, align:'center',sortable:true,formatter:'select',        editoptions:{value:'0:禁用;1:启用;2:脱离'}},    {name:'create_time',index:'create_time', width:300, align:'center',sortable:true,        formatter : 'date', formatoptions : {srcformat : 'Y-m-d H:i:s',newformat : 'Y-m-d H:i:s'}},    {name:'due_time',index:'due_time', width:300, align:'center',sortable:true,        formatter : 'date', formatoptions : {srcformat : 'Y-m-d H:i:s',newformat : 'Y-m-d H:i:s'}}];$(function(){    jQuery("#list").jqGrid({        url:'/members?isWeb=1',        datatype: "json",        mtype: 'GET',        colNames:colNames,        colModel:colModel,   //由后台control中获得显示数据        gridview:true, //加速显示        multiselect: true,  //可多选，出现多选框        multiselectWidth: 25, //设置多选列宽度        rowNum:10,        rowList:[10,20,30],        pager: '#pager',        sortname: 'create_time',        sortorder:'desc',        viewrecords: true,        caption:"员工列表",        autowidth: true, //自动匹配宽度        height: 300,        prmNames : {            rows:"limit" // 表示请求行数的参数名称        },        loadComplete:function(data){ //完成服务器请求后，回调函数            if(data.records == undefined){ //如果没有记录返回，追加提示信息，删除按钮不可用                $("p").appendTo($("#list")).addClass("nodata").html('找不到相关数据！');                $("#del_btn").attr("disabled",true);            }else{ //否则，删除提示，删除按钮可用                $("p.nodata").remove();                $("#del_btn").removeAttr("disabled");            }        },        loadError:function(xhr,status,error){            $("p").appendTo($("#list")).addClass("nodata").html('找不到相关数据！');            $("#del_btn").attr("disabled",true);        }    });    $("#add_btn").click(function(){        $.fancybox({            'title':'新增员工',            'autoDimensions':false,            'type':'ajax',            'href':'/member',            'width': 500,            'height': 600,            'modal':true,            'titleShow':true,            'titlePosition':'over',            'showCloseButton':true,            'showNavArrows':false,            'transitionIn': 'elastic',//（效果出入）属性值有三个：fade,elastic,none,含义分别为淡入淡出、弹性缩放、无，默认值为fade。            'transitionOut': 'elastic',            'centerOnScroll':false,            'onComplete': function() {$("#fancybox-title").css({'top':'0px', 'bottom':'auto'});}        });    });    $("#view_btn").click(function(){        var sels = $("#list").jqGrid('getGridParam','selarrrow');        if(sels==""){            $().message("请选择要查看的项！");        }else{            if(sels.toString().indexOf(',') > 0){                $().message("只可选择一项进行查看！");            }else{                $.fancybox({                    'title':'查看员工信息',                    'titleFormat': function(title, currentArray, currentIndex, currentOpts) {                        var str = '<span id="fancybox-title-over">'                            + (currentIndex + 1) + ' / '                            + currentArray.length                            + (title.length ? '   ' + title : '')                            + '</span>';                        return str;                    },                    'autoDimensions':false,                    'type':'ajax',                    'href':'/member/'+sels+"/false",                    'width': 500,                    'height': 600,                    'modal':true,                    'titleShow':true,                    'titlePosition':'over',                    'cyclic': true,                    'showCloseButton':true,                    'showNavArrows':false,                    'transitionIn': 'elastic',//（效果出入）属性值有三个：fade,elastic,none,含义分别为淡入淡出、弹性缩放、无，默认值为fade。                    'transitionOut': 'elastic',                    'centerOnScroll':false,                    'onComplete': function() {$("#fancybox-title").css({'top':'0px', 'bottom':'auto'});}                });            }        }    });    $("#edit_btn").click(function(){        var sels = $("#list").jqGrid('getGridParam','selarrrow');        if(sels==""){            $().message("请选择要编辑的项！");        }else{            if(sels.toString().indexOf(',') > 0){                $().message("只可选择一项进行编辑！");            }else{                $.fancybox({                    'title':'修改员工信息',                    'titleFormat': function(title, currentArray, currentIndex, currentOpts) {                        var str = '<span id="fancybox-title-over">'                            + (currentIndex + 1)                            + ' / ' + currentArray.length                            + (title.length ? '   ' + title : '')                            + '</span>';                        return str;                    },                    'autoDimensions':false,                    'type':'ajax',                    'href':'/member/'+sels+"/true",                    'width': 500,                    'height': 600,                    'modal':true,                    'titleShow':true,                    'titlePosition':'over',                    'cyclic': true,                    'showCloseButton':true,                    'showNavArrows':false,                    'transitionIn': 'elastic',//（效果出入）属性值有三个：fade,elastic,none,含义分别为淡入淡出、弹性缩放、无，默认值为fade。                    'transitionOut': 'elastic',                    'centerOnScroll':false,                    'onComplete': function() {$("#fancybox-title").css({'top':'0px', 'bottom':'auto'});}                });            }        }    });    $("#del_btn").click(function(){        var sels = $("#list").jqGrid('getGridParam','selarrrow');        if(sels==""){            $().message("请选择要删除的项！");        }else{            if(confirm("您是否确认删除？")){                $.ajax({                    type: "delete",                    url: "/member/"+sels,                    data: "_csrf=#{csrf}",                    beforeSend: function() {                        $().message("正在请求...");                    },                    error:function(){                        $().message("请求失败...");                    },                    success: function(msg){                        if(msg._ids){                            var arr = msg._ids.split(',');                            $.each(arr,function(i,n){                                if(arr[i]!=""){                                    $("#list").jqGrid('delRowData',n);                                }                            });                            $().message("已成功删除!");                        }else{                            $().message("操作失败！");                        }                    }                });            }        }    });    $("#find_btn").click(function(){        var obj = {};//new Object();        $(".query_input").each(function(){            var key = $(this).attr('id');            var value = $(this).val();            obj[key] = value;            /*             if(value && value.trim() != "") {             obj[key] = value;             }else{             delete obj[key];             }*/        });        console.log(obj);        $("#list").jqGrid('setGridParam',{            url:"/member/index",            postData:obj,            page:1        }).trigger("reloadGrid");    });});