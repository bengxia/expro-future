//mocha test/deal.js var session = require('./session.lib.js');var logEnable = true;var sid;var dataId;var newJson = {    store_id:111,    pet_name:"测试-员工-将被删除",    cellphone:13912345678,    role_id:1,    state:1,    sex:0,    birthday:"1977-11-11",    due_time:"2024-12-30",    user_id:2,    privacy:0,    point:200,    savings:100,    comment:"备注一下"};function log(obj){    if(logEnable){        console.log(JSON.stringify(obj));    }};function signin(data, done, ct) {    session.postData('/signin', data, '', ct)        .end(function(res) {            res.statusCode.should.equal(200);            res.body.should.have.property('name');            sid = session.getSID(res);            done();        });};function addData(data, sid, done, ct) {    session.postData('/staff', data, sid, ct)        .end(function(res2) {            res2.statusCode.should.equal(201);            res2.should.be.json;            log(res2.body);            dataId = res2.body.staff._id;            done();        })};function findOneData(id, sid, done, ct) {    session.getData('/staff/'+id, sid)        .end(function(res2) {            res2.statusCode.should.equal(200);            res2.should.be.json;            log(res2.body);            done();        })};function deleteData(id, sid, done, ct) {    session.deleteData('/staff/'+id, '', sid, ct)        .end(function(res2) {            res2.statusCode.should.equal(202);            res2.should.be.json;            log(res2.body);            done();        });};function updateData(data, sid, done, ct) {    session.putData('/staff', data, sid, ct)        .end(function(res2) {            res2.statusCode.should.equal(200);            res2.should.be.json;            log(res2.body);            done();        });};function getList(sid, done) {    session.getData('/staffs', sid)        .end(function(res) {            res.statusCode.should.equal(200);            res.should.be.json;            log(res.body);            done();        });};describe('----商户员工测试模块----', function() {    it('验证用户登录，并获得sid。', function(done) {        signin({            cellphone:'18912345678',            password:'123456',            org:'1'        }, done);    });    it('返回当前商户的所有员工信息列表。', function(done) {        getList(sid, done);    });    it('创建员工并关联商户', function(done) {        addData(newJson, sid, done);    });    it('查询新增的员工', function(done) {        findOneData(dataId, sid, done);    });    it('更新员工', function(done) {        newJson._id = dataId;        newJson.pet_name = "测试更新-员工甲-将被删除";        updateData(newJson, sid, done);    });    it('查询更新的员工', function(done) {        findOneData(dataId, sid, done);    });    it('取消员工与商户的关联，删除数据。', function(done) {        deleteData(dataId, sid, done);    })});