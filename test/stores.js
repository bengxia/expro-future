//mocha test/deal.js var session = require('./session.lib.js');var logEnable = true;var sid;var dataId;var newJson = {    merchant_id:1,    name:"测试-胜太路门店-将被删除",    state:1,    inventar_num:"000111222",    district_code:"025-10001",    address:"南京市江宁区胜太路68号",    transit_info:"做12路车可直达",    map_info:"111,222,333,444",    notice:"公告：全部85折优惠！",    comment:"备注一下"};function log(obj){    if(logEnable){        console.log(JSON.stringify(obj));    }};function signin(data, done, ct) {    session.postData('/signin', data, '', ct)        .end(function(res) {            res.statusCode.should.equal(200);            res.body.should.have.property('name');            sid = session.getSID(res);            done();        });};function addData(data, sid, done, ct) {	session.postData('/store', data, sid, ct)        .end(function(res) {            res.statusCode.should.equal(201);            res.should.be.json;            log(res.body);            dataId = res.body.store._id;            done();        });};function deleteData(id, sid, done, ct) {	session.deleteData('/store/'+id, '', sid, ct)        .end(function(res) {            res.statusCode.should.equal(202);            res.should.be.json;            log(res.body);            done();        });};function updateData(data, sid, done, ct) {    session.putData('/store', data, sid, ct)        .end(function(res) {            res.statusCode.should.equal(200);            res.should.be.json;            log(res.body);            done();        });};function findOneData(id, sid, done, ct) {    session.getData('/store/'+id, sid)        .end(function(res) {            res.statusCode.should.equal(200);            res.should.be.json;            log(res.body);            done();        });};function getList(sid, done) {    session.getData('/stores', sid)        .end(function(res) {            res.statusCode.should.equal(200);            res.should.be.json;            log(res.body);            done();        });};describe('----商户门店测试模块----', function() {    it('1、验证用户登录，并获得sid。', function(done) {        signin({            cellphone:'18912345678',            password:'123456',            org:'1'        }, done);    });    it('2、获取全部门店列表。', function(done) {        getList(sid, done);    });    it('3、创建门店并关联商户。', function(done) {        addData(newJson, sid, done);    });    it('4、查询新增的门店。', function(done) {        findOneData(dataId, sid, done);    });    it('5、更新门店。', function(done) {        newJson._id = dataId;        newJson.name = "测试更新-胜太路门店-将被删除";        updateData(newJson, sid, done);    });    it('6、查询更新的门店。', function(done) {        findOneData(dataId, sid, done);    });    it('7、取消门店与商户的关联。', function(done) {        deleteData(dataId, sid, done);    });});