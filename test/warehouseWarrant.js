//mocha test/deal.js var session = require('./session.lib.js');var logEnable = true;var sid;var dataId;var newJson = {warehouse_warrant:{recipient_id:122, comment:"测试-新增仓单-将被删除", source_id:123, warehouse_warrant_item:[    {goods_id:157, num:1, supplier_id:"泛盈科技虚拟供货商", unit_cost:2222.00, total_cost:2222.00},    {goods_id:83, num:1, supplier_id:"泛盈科技虚拟供货商", unit_cost:1999.00, total_cost:1999.00},    {goods_id:84, num:12, supplier_id:"泛盈科技虚拟供货商", unit_cost:1699.00, total_cost:20388.00}]}};function log(obj){    if(logEnable){        console.log(JSON.stringify(obj));    }};function signin(data, done, ct) {    session.postData('/signin', data, '', ct)        .end(function(res) {            res.statusCode.should.equal(200);            res.body.should.have.property('name');            sid = session.getSID(res);            done();        });};function addData(data, sid, done, ct) {    session.postData('/warehouse_warrant', data, sid, ct)        .end(function(res2) {            res2.statusCode.should.equal(201);            res2.should.be.json;            log(res2.body);            dataId = res2.body.warehouse_warrant._id;            done();        })};function findOneData(id, sid, done, ct) {    session.getData('/warehouse_warrant/'+id, sid)        .end(function(res2) {            res2.statusCode.should.equal(200);            res2.should.be.json;            log(res2.body);            done();        })};function deleteData(id, sid, done, ct) {    session.deleteData('/warehouse_warrant/'+id, '', sid, ct)        .end(function(res2) {            res2.statusCode.should.equal(202);            res2.should.be.json;            log(res2.body);            done();        });};function updateData(data, sid, done, ct) {    session.putData('/warehouse_warrant', data, sid, ct)        .end(function(res2) {            res2.statusCode.should.equal(200);            res2.should.be.json;            log(res2.body);            done();        })};function getList(sid, done) {    session.getData('/warehouse_warrants', sid)        .end(function(res) {            res.statusCode.should.equal(200);            res.should.be.json;            log(res.body);            done();        });};describe('----商户仓单测试模块----', function() {    it('验证用户登录，并获得sid。', function(done) {        signin({            cellphone:'18912345678',            password:'123456',            org:'1'        }, done);    });    it('返回当前商户的所有仓单信息列表。', function(done) {        getList(sid, done);    });    it('创建仓单', function(done) {        addData(newJson, sid, done);    });    it('查询新增的仓单', function(done) {        findOneData(dataId, sid, done);    });    it('更新仓单', function(done) {        newJson.warehouse_warrant._id = dataId;        newJson.warehouse_warrant.comment = "测试更新-仓单-将被删除";        updateData(newJson, sid, done);    });    it('查询更新的仓单', function(done) {        findOneData(dataId, sid, done);    });    it('取消仓单，删除数据。', function(done) {        deleteData(dataId, sid, done);    })});