.fanbox    link(rel='stylesheet', type='text/css', href='/libs/JQuery_zTree_v3.2/css/zTreeStyle/zTreeStyle.css', media='screen')    script(type='text/javascript', src='/libs/JQuery_zTree_v3.2/js/jquery.ztree.core-3.2.js')    style        #testIframe {margin-left: 10px;}    br    br    br    #menuContent.menuContent(style='display:none; position: absolute;background-color:#FF8040')        ul#treeDemo.ztree(style="margin-top:0; width:160px;")    form#add_form(action='/goods/#{locals.goods?'?_id='+goods._id:''}', method='#{method}')        table.post_table(align='center', width='90%', cellpadding='0', cellspacing='0',border='0', style='BORDER: #13458B 1px dashed;')            tr                td(height='60px', width='30%', align='right', valign='top')                td(width='70%', align='left', valign='top')                    input(type='hidden', name='_csrf', value='#{csrf}')                    input(type='hidden', name='_id', value='#{locals.goods?goods._id:''}')                    input#save.btn(type='submit', value=' 保 存 ')                    input#close.btn(type='button', value=' 关 闭 ', onclick='$.fancybox.close();')            tr(height='40px')                td(width='30%', align='right') 系统流水号：                td(width='70%')                    lable #{locals.goods?goods._id:''}            tr(height='40px')                td(width='30%', align='right') 名称：                td                    input.input2(type='text', name='name', maxlength='30', value='#{locals.goods?goods.name:''}')            tr(height='40px')                td(width='30%', align='right') 资产编号：                td                    input.input2(type='text', name='code', maxlength='30', value='#{locals.goods?goods.code:''}')            tr(height='40px')                td(width='30%', align='right') 商品类型：                td                    input#citySel.input2(type='hidden', name='type_id', maxlength='30', value='#{locals.goods?goods.type_id:''}')                    input#type_name.input2(type='text', name='#type_name', maxlength='30', value='#{locals.goods?goods.name:''}', disabled)                    a#menuBtn(href='#', onclick="showMenu(); return false;")选择商品类型            tr(height='40px')                td(width='30%', align='right') 状态：                td                  select.input2(name='state')                    - var states = [{id:1,value:'上架'},{id:0,value:'下架'}];                    - for (var i in states)                      - var str = "<option value='"+states[i].id+"' >"+states[i].value + " </option>"                      - if(locals.goods && states[i].id == goods.state)                          str = "<option value='"+states[i].id+"' selected='selected'>"+states[i].value + " </option>"                      | !{str}            tr(height='40px')                td(width='30%', align='right') 售价：                td                    input.input2(type='text', name='price', maxlength='30', value='#{locals.goods?goods.price:''}')            tr(height='40px')                td(width='30%', align='right') 创建时间：                td                    lable #{locals.goods?goods.create_time:''}            tr(height='100px')                td(width='30%', align='right', valign='top') 备注：                td                    textarea(rows='5', cols='50', name='comment') #{locals.goods?goods.comment:''}script(type='text/javascript')    var zTree;    var zNodes;//保存树节点的json对象    var setting = {        async: {            enable: true,            type:"get",            dataType:"text",            contentType:"application/json",            url:"/goods/type",            autoParam:["_id", "name"],            otherParam:{"otherParam":""},//可以传参，暂未使用            dataFilter: filter        },        view: {            dblClickExpand: false,            showLine: true,            selectedMulti: false,            expandSpeed: ($.browser.msie && parseInt($.browser.version)<=6)?"":"fast"        },        data: {            simpleData: {                enable:true,                idKey: "_id",                pIdKey: "parent_id",                rootPId: ""            }        },        callback: {            beforeClick: beforeClick,            onClick: onClick        }    };    function filter(treeId, parentNode, childNodes) {            if (!childNodes) return null;            for (var i=0, l=childNodes.length; i<l; i++) {                childNodes[i].name = childNodes[i].name.replace(/\.n/g, '.');            }            return childNodes;        };    function beforeClick(treeId, treeNode) {        //var check = (treeNode && !treeNode.isParent);        //if (!check) alert("只能选择叶子节点...");        //return check;        return true;    }    function onClick(e, treeId, treeNode) {        zTree = $.fn.zTree.getZTreeObj("treeDemo"),        nodes = zTree.getSelectedNodes(),        v = "";        _id = "";        //nodes.sort(function compare(a,b){return a.id-b.id;});        if(nodes.length){            v = nodes[0].name;            _id = nodes[0]._id;        }        //if (v.length > 0 ) v = v.substring(0, v.length-1);        var cityObj = $("#citySel");        var type_name = $("#type_name");        cityObj.attr("value", _id);        type_name.attr("value", v);        hideMenu();    }    function showMenu() {        var cityObj = $("#type_name");        var cityOffset = $("#type_name").offset();        var dialogOffset = $("#fancybox-inner").offset();        var left = cityOffset.left - dialogOffset.left;        var top = cityOffset.top - dialogOffset.top;        $("#menuContent").css({left:left + "px", top:top + cityObj.outerHeight() + "px"}).slideDown("fast");        $("body").bind("mousedown", onBodyDown);    }    function hideMenu() {        $("#menuContent").fadeOut("fast");        $("body").unbind("mousedown", onBodyDown);    }    function onBodyDown(event) {        if (!(event.target.id == "menuBtn" || event.target.id == "menuContent" || $(event.target).parents("#menuContent").length>0)) {            hideMenu();        }    }    $(document).ready(function(){            $.ajax({                type: "Get",                url: '/goods/type',                dataType: "text",                global: false,                async: false,                success: function (strReult) {                    zNodes=eval(strReult);                },                error: function () {                    alert("Ajax请求数据失败!");                }            });            var t = $("#treeDemo");            t = $.fn.zTree.init(t, setting, zNodes);        });    $(function(){      $('#add_form').ajaxForm({          beforeSubmit: validate,          success: function(msg){              if(msg.status=='success'){                  $().message("成功添加");                  $("#list").trigger("reloadGrid", [{current:true}]);              }else{                $().message("添加失败:"+msg.status);              }          }      });      pageInit();    });    function validate(formData, jqForm, options) {      /*        $(".input2").each(function(){            alert($(this).val())          });      for (var i=0; i < formData.length; i++) {          if (!formData[i].value) {              $().message("<b>请输入完整相关信息</b>");              return false;          }      }*/      $.fancybox.close();//为防止因为网络延时造成对话框不关闭，再次输入，提前关闭对话框。      $().message("正在提交...");    };    //页面初始化时调用，设置按钮显示，输入框是否只读等属性。    function pageInit(){        if(#{isReadonly}){            $(".input2").attr("readonly","readonly");            $("#menuBtn").hide();        }        if(#{!isShowSaveBt}){            $("#save").hide();        }    };