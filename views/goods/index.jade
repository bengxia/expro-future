!=partial('stores/sidebar')//以下是JQuery ui的jsscript(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.core.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.widget.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.datepicker.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui//i18n/jquery.ui.datepicker-zh-CN.js')//以下是一个jqGrid+fancybox的解决方案jsscript(type='text/javascript', src='/libs/jqGrid_fancybox/js/i18n/grid.locale-cn.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.jqGrid.min.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.fancybox.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.form.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.message.js')style    select, input[type="file"] {        height: 18px;        line-height: 28px;    }#content  .panel    .header      ul.breadcrumb        li          a(href='/') 主页          span.divider /        li.active 商品管理    table(border='0', width='100%')        tr            td                form                    table(border='0', width='100%')                        ////////////////////////增删改查区域Start                        tr                            td(width='100%', align='left', valign='baseline', colspan=4)                                #page_operate(style='visibility:none;')                                    input#show_type.btn(type='button', value='商品类型管理')                                    input#add_btn.btn(type='button', value='新 增')                                    input#view_btn.btn(type='button', value='查 看')                                    input#edit_btn.btn(type='button', value='修 改')                                    input#del_btn.btn(type='button', value='删 除')                        ////////////////////////增删改查区域End                        ////////////////////////查询条件自动生成 Start                        isOne = 0;                        i = 0;                        //此处处理只有一个查询条件时的布局                        each val, key in queryInput                            - isOne++;                        each val, key in queryInput                            if(isOne == 1)                                tr                                    td(width='10%', align='right', valign='top')                                        label(style="display:block;float:right;font-weight: bold") #{val}：                                    td(width='90%', align='left', valign='top', colspan=3)                                        input.query_input(id='#{key}', type='text')                            else                                if(i%2==0)                                    tr                                - i++;                                td(width='15%', align='right', valign='top')                                    label(style="display:block;float:right;font-weight: bold") #{val}：                                td(width='35%', align='left', valign='top')                                    input.query_input(id='#{key}', type='text')                        tr                            td(width='100%', align='left', valign='top', colspan=4)                                #page_query(style='visibility:none;')                                    input#find_btn.btn(type='button', value='查 询')                                    input#reset_btn.btn(type='reset', value='重 置')                        ////////////////////////查询条件自动生成 End        tr            td                .inner                    table#list                    #pager                    .cl.crscript(type='text/javascript')    //设置前台页面显示的表格列头    var colNames = ['编号', '名称', '商品类型ID', '商品类型','状态','资产编号','售价','创建时间','备注'];    //设置前台页面显示的表格数据    var colModel = [        {name:'_id',index:'_id', width:100, align:"center",sortable:true},        {name:'name',index:'name', width:200, align:"center",sortable:true},        {name:'type_id',index:'type_id', width:200, align:"center",sortable:true, hidden:true},        {name:'type_name',index:'type_name', width:200, align:"center",sortable:true},        {name:'state',index:'state', width:150, align:"center",sortable:true,formatter:'select', editoptions:{value:"0:下架;1:上架"}},        {name:'code',index:'code', width:200,align:"center",sortable:true},        {name:'price',index:'price', width:200, align:"center",sortable:true},        {name:'create_time',index:'create_time', width:300, align:"center",sortable:true,            formatter : 'date', formatoptions : {srcformat : 'Y-m-d',newformat : 'Y-m-d'}        },        {name:'comment',index:'comment', width:200, align:"left",sortable:true, hidden:true}];    jQuery("#list").jqGrid({        url:'/goods?isWeb=1',        datatype: "json",        mtype: 'GET',        colNames:colNames,        colModel:colModel,        gridview:true, //加速显示        multiselect: true,  //可多选，出现多选框        multiselectWidth: 25, //设置多选列宽度        rowNum:10,        rowList:[10,20,30],        pager: '#pager',        sortname: 'create_time',        sortorder:'desc',        viewrecords: true,        caption:"商品列表",        autowidth: true, //自动匹配宽度        height: 300,        loadComplete:function(data){ //完成服务器请求后，回调函数            console.log(data);          if(data.records == undefined){ //如果没有记录返回，追加提示信息，删除按钮不可用              $("p").appendTo($("#list")).addClass("nodata").html('找不到相关数据！');              $("#del_btn").attr("disabled",true);          }else{ //否则，删除提示，删除按钮可用              $("p.nodata").remove();              $("#del_btn").removeAttr("disabled");          }        },        loadError:function(xhr,status,error){            $("p").appendTo($("#list")).addClass("nodata").html('找不到相关数据！');            $("#del_btn").attr("disabled",true);        }    });    $(function(){        $("#show_type").click(function(){            $.fancybox({                'title':'商品类型管理',                'autoDimensions':false,                'type':'ajax',                'href':'/goods/type',                'width': 500,                'height': 600,                'modal':true,                'titleShow':true,                'titlePosition':'over',                'showCloseButton':true,                'showNavArrows':false,                'transitionIn': 'elastic',//（效果出入）属性值有三个：fade,elastic,none,含义分别为淡入淡出、弹性缩放、无，默认值为fade。                'transitionOut': 'elastic',                'centerOnScroll':false,                'onComplete': function() {$("#fancybox-title").css({'top':'0px', 'bottom':'auto'});}            });        });        $("#add_btn").click(function(){            $.fancybox({                'title':'新增商品',                'autoDimensions':false,                'type':'ajax',                'href':'/goods/new',                'width': 500,                'height': 600,                'modal':true,                'titleShow':true,                'titlePosition':'over',                'showCloseButton':true,                'showNavArrows':false,                'transitionIn': 'elastic',//（效果出入）属性值有三个：fade,elastic,none,含义分别为淡入淡出、弹性缩放、无，默认值为fade。                'transitionOut': 'elastic',                'centerOnScroll':false,                'onComplete': function() {$("#fancybox-title").css({'top':'0px', 'bottom':'auto'});}            });        });        $("#view_btn").click(function(){            var sels = $("#list").jqGrid('getGridParam','selarrrow');                if(sels==""){                    $().message("请选择要查看的项！");                }else{                    if(sels.toString().indexOf(',') > 0){                        $().message("只可选择一项进行查看！");                    }else{                        $.fancybox({                            'title':'查看商品',                             'titleFormat': function(title, currentArray, currentIndex, currentOpts) {                                                var str = '<span id="fancybox-title-over">'                                                    + (currentIndex + 1) + ' / '                                                    + currentArray.length                                                    + (title.length ? '   ' + title : '')                                                    + '</span>';                                                return str;                                                },                            'autoDimensions':false,                            'type':'ajax',                            'href':'/goods/'+sels+'/false',                            'width': 500,                            'height': 600,                            'modal':true,                            'titleShow':true,                            'titlePosition':'over',                             'cyclic': true,                            'showCloseButton':true,                            'showNavArrows':false,                            'transitionIn': 'elastic',//（效果出入）属性值有三个：fade,elastic,none,含义分别为淡入淡出、弹性缩放、无，默认值为fade。                            'transitionOut': 'elastic',                            'centerOnScroll':false,                            'onComplete': function() {$("#fancybox-title").css({'top':'0px', 'bottom':'auto'});}                        });                    }                }        });        $("#edit_btn").click(function(){            var sels = $("#list").jqGrid('getGridParam','selarrrow');            if(sels==""){                $().message("请选择要编辑的项！");            }else{                if(sels.toString().indexOf(',') > 0){                    $().message("只可选择一项进行编辑！");                }else{                    $.fancybox({                        'title':'修改商品',                         'titleFormat': function(title, currentArray, currentIndex, currentOpts) {                                            var str = '<span id="fancybox-title-over">'                                                + (currentIndex + 1)                                                + ' / ' + currentArray.length                                                + (title.length ? '   ' + title : '')                                                + '</span>';                                            return str;                                            },                        'autoDimensions':false,                        'type':'ajax',                        'href':'/goods/'+sels+'/true',                        'width': 500,                        'height': 600,                        'modal':true,                        'titleShow':true,                        'titlePosition':'over',                         'cyclic': true,                        'showCloseButton':true,                        'showNavArrows':false,                        'transitionIn': 'elastic',//（效果出入）属性值有三个：fade,elastic,none,含义分别为淡入淡出、弹性缩放、无，默认值为fade。                        'transitionOut': 'elastic',                        'centerOnScroll':false,                        'onComplete': function() {$("#fancybox-title").css({'top':'0px', 'bottom':'auto'});}                    });                }            }        });        $("#del_btn").click(function(){            var sels = $("#list").jqGrid('getGridParam','selarrrow');            if(sels==""){                $().message("请选择要删除的项！");            }else{                if(confirm("您是否确认删除？")){                    $.ajax({                        type: "delete",                        url: "/goods/"+sels,                        data: "_csrf=#{csrf}",                        beforeSend: function() {                            $().message("正在请求...");                        },                        error:function(){                            $().message("请求失败...");                        },                        success: function(msg){                            if(200 == msg.status){                                var arr = msg._ids.split(',');                                $.each(arr,function(i,n){                                    if(arr[i]!=""){                                        $("#list").jqGrid('delRowData',n);                                    }                                });                                $().message("已成功删除!");                            }else{                                $().message("操作失败！");                            }                        }                    });                }            }        });        $("#find_btn").click(function(){            var obj = new Object();            $(".query_input").each(function(){                var key = $(this).attr('id');                var value = $(this).val();                obj[key] = value;            });            $("#list").jqGrid('setGridParam',{                url:"/goods/index",                postData:obj,                page:1            }).trigger("reloadGrid");        });    });