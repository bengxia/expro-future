!=partial('stores/sidebar')//以下是一个jqGrid+fancybox的解决方案link(rel='stylesheet', type='text/css', href='/libs/jqGrid_fancybox/css/ui-lightness/jquery-ui-1.8.2.custom.css', media='screen')link(rel='stylesheet', type='text/css', href='/libs/jqGrid_fancybox/css/ui.jqgrid.css', media='screen')link(rel='stylesheet', type='text/css', href='/libs/jqGrid_fancybox/css/fancybox.css', media='screen')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/i18n/grid.locale-cn.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.jqGrid.min.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.fancybox.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.form.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.message.js')style     input, textarea, select, .uneditable-input {         width: auto;         padding: 0px;     }     #opt{height:150px; }     .input{width:120px; height:19px; line-height:19px; padding:1px; border:1px solid #ccc}     .btn{width:58px; height:24px; border:1px solid #ccc; background:url(/images/btn_bg.gif) repeat-x; cursor:pointer;}     .fanbox{width:700px; padding:0}     .fanbox h3{height:32px; line-height:32px; padding-left:12px; background:#369; color:#fff}     .input2{width:220px; height:20px; line-height:20px; padding:1px; border:1px solid #999}     .jquery-message{position:absolute;  top:15%; left:45%; background:#217eb9; border:1px solid #ff9; padding:3px 12px 3px 12px; z-index:9001; color:#fff;}     .nodata{display:block; position:absolute; top:100px; left:35%; padding:6px 20px; border:1px solid #fc9; background:#ffc;}     td a{color:#369}     .fanbox h3{height:32px; line-height:32px; padding-left:12px; background:#369; color:#fff}     //单元格内的文本自动换行 ：     .ui-jqgrid tr.jqgrow td {         white-space: normal !important;         height:auto;         vertical-align:text-top;         padding-top:2px;     }#content  .panel    .header      ul.breadcrumb        li          a(href='/') 主页          span.divider /        li.active 员工管理    table(border='0', width='100%')        tr            td                form                    table(border='0', width='100%')                        ////////////////////////增删改查区域Start                        tr                            td(width='100%', align='left', valign='baseline', colspan=4)                                #page_operate(style='visibility:none;')                                    input#add_btn.btn(type='button', value='新 增')                                    input#view_btn.btn(type='button', value='查 看')                                    input#edit_btn.btn(type='button', value='修 改')                                    input#del_btn.btn(type='button', value='删 除')                        ////////////////////////增删改查区域End                        ////////////////////////查询条件自动生成 Start                        isOne = 0;                        i = 0;                        //此处处理只有一个查询条件时的布局                        each val, key in queryInput                            - isOne++;                        each val, key in queryInput                            if(isOne == 1)                                tr                                    td(width='10%', align='right', valign='top')                                        label(style="display:block;float:right;font-weight: bold") #{val}：                                    td(width='90%', align='left', valign='top', colspan=3)                                        input.query_input(id='#{key}', type='text')                            else                                if(i%2==0)                                    tr                                - i++;                                td(width='15%', align='right', valign='top')                                    label(style="display:block;float:right;font-weight: bold") #{val}：                                td(width='35%', align='left', valign='top')                                    input.query_input(id='#{key}', type='text')                        tr                            td(width='100%', align='left', valign='top', colspan=4)                                #page_query(style='visibility:none;')                                    input#find_btn.btn(type='button', value='查 询')                                    input#reset_btn.btn(type='reset', value='重 置')                        ////////////////////////查询条件自动生成 End        tr            td                .inner                    table#list                    #pager                    .cl.crscript(type='text/javascript')    jQuery("#list").jqGrid({        url:'/member/index',        datatype: "json",        mtype: 'GET',        colNames:!{JSON.stringify(colNames)},        colModel:!{JSON.stringify(colModel)},//由后台control中获得显示数据        gridview:true, //加速显示        multiselect: true,  //可多选，出现多选框        multiselectWidth: 25, //设置多选列宽度        rowNum:10,        rowList:[10,20,30],        pager: '#pager',        sortname: 'create_time',        sortorder:'desc',        viewrecords: true,        caption:"员工列表",        autowidth: true, //自动匹配宽度        height: 300,        editurl:"/member/index",        loadComplete:function(data){ //完成服务器请求后，回调函数          if(data.records == undefined){ //如果没有记录返回，追加提示信息，删除按钮不可用              $("p").appendTo($("#list")).addClass("nodata").html('找不到相关数据！');              $("#del_btn").attr("disabled",true);          }else{ //否则，删除提示，删除按钮可用              $("p.nodata").remove();              $("#del_btn").removeAttr("disabled");          }        }    });    $(function(){        $("#add_btn").click(function(){            $.fancybox({                'title':'新增员工',                'autoDimensions':false,                'type':'ajax',                'href':'/member',                'width': 400,                'height': 500,                'modal':true,                'titleShow':true,                'titlePosition':'over',                'showCloseButton':true,                'showNavArrows':false,                'transitionIn': 'elastic',//（效果出入）属性值有三个：fade,elastic,none,含义分别为淡入淡出、弹性缩放、无，默认值为fade。                'transitionOut': 'elastic',                'centerOnScroll':false,                'onComplete': function() {$("#fancybox-title").css({'top':'0px', 'bottom':'auto'});}            });        });        $("#view_btn").click(function(){            var sels = $("#list").jqGrid('getGridParam','selarrrow');                if(sels==""){                    $().message("请选择要查看的项！");                }else{                    if(sels.toString().indexOf(',') > 0){                        $().message("只可选择一项进行查看！");                    }else{                        $.fancybox({                            'title':'查看员工信息',                             'titleFormat': function(title, currentArray, currentIndex, currentOpts) {                                                var str = '<span id="fancybox-title-over">'                                                    + (currentIndex + 1) + ' / '                                                    + currentArray.length                                                    + (title.length ? '   ' + title : '')                                                    + '</span>';                                                return str;                                                },                            'autoDimensions':false,                            'type':'ajax',                            'href':'/member/'+sels+"/false",                            'width': 800,                            'height': 500,                            'modal':true,                            'titleShow':true,                            'titlePosition':'over',                             'cyclic': true,                            'showCloseButton':true,                            'showNavArrows':false,                            'transitionIn': 'elastic',//（效果出入）属性值有三个：fade,elastic,none,含义分别为淡入淡出、弹性缩放、无，默认值为fade。                            'transitionOut': 'elastic',                            'centerOnScroll':false,                            'onComplete': function() {$("#fancybox-title").css({'top':'0px', 'bottom':'auto'});}                        });                    }                }        });        $("#edit_btn").click(function(){            var sels = $("#list").jqGrid('getGridParam','selarrrow');            if(sels==""){                $().message("请选择要编辑的项！");            }else{                if(sels.toString().indexOf(',') > 0){                    $().message("只可选择一项进行编辑！");                }else{                    $.fancybox({                        'title':'修改员工信息',                         'titleFormat': function(title, currentArray, currentIndex, currentOpts) {                                            var str = '<span id="fancybox-title-over">'                                                + (currentIndex + 1)                                                + ' / ' + currentArray.length                                                + (title.length ? '   ' + title : '')                                                + '</span>';                                            return str;                                            },                        'autoDimensions':false,                        'type':'ajax',                        'href':'/member/'+sels+"/true",                        'width': 800,                        'height': 500,                        'modal':true,                        'titleShow':true,                        'titlePosition':'over',                         'cyclic': true,                        'showCloseButton':true,                        'showNavArrows':false,                        'transitionIn': 'elastic',//（效果出入）属性值有三个：fade,elastic,none,含义分别为淡入淡出、弹性缩放、无，默认值为fade。                        'transitionOut': 'elastic',                        'centerOnScroll':false,                        'onComplete': function() {$("#fancybox-title").css({'top':'0px', 'bottom':'auto'});}                    });                }            }        });        $("#del_btn").click(function(){            var sels = $("#list").jqGrid('getGridParam','selarrrow');            if(sels==""){                $().message("请选择要删除的项！");            }else{                if(confirm("您是否确认删除？")){                    $.ajax({                        type: "delete",                        url: "/member/"+sels,                        data: "_csrf=#{csrf}",                        beforeSend: function() {                            $().message("正在请求...");                        },                        error:function(){                            $().message("请求失败...");                        },                        success: function(msg){                            if(msg._ids){                                var arr = msg._ids.split(',');                                $.each(arr,function(i,n){                                    if(arr[i]!=""){                                        $("#list").jqGrid('delRowData',n);                                    }                                });                                $().message("已成功删除!");                            }else{                                $().message("操作失败！");                            }                        }                    });                }            }        });        $("#find_btn").click(function(){            var obj = {};//new Object();            $(".query_input").each(function(){                var key = $(this).attr('id');                var value = $(this).val();                obj[key] = value;                /*                if(value && value.trim() != "") {                    obj[key] = value;                }else{                    delete obj[key];                }*/            });            console.log(obj);            $("#list").jqGrid('setGridParam',{                url:"/member/index",                postData:obj,                page:1            }).trigger("reloadGrid");        });    });