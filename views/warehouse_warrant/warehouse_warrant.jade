//以下是JQuery ui的jsscript(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.core.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.widget.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.datepicker.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui//i18n/jquery.ui.datepicker-zh-CN.js')//以下是一个jqGrid+fancybox的解决方案jsscript(type='text/javascript', src='/libs/jqGrid_fancybox/js/i18n/grid.locale-cn.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.jqGrid.min.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.fancybox.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.form.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.message.js')link(rel='stylesheet', type='text/css', href='/libs/JQuery_zTree_v3.2/css/zTreeStyle/zTreeStyle.css', media='screen')script(type='text/javascript', src='/libs/JQuery_zTree_v3.2/js/jquery.ztree.core-3.2.js')script(type='text/javascript', src='/libs/dataTables/js/jquery.dataTables.js')link(rel='stylesheet', type='text/css', href='/libs/dataTables/css/demo_page.css', media='screen')link(rel='stylesheet', type='text/css', href='/libs/dataTables/css/demo_table.css', media='screen')style    select, input[type="file"] {        height: 18px;        line-height: 28px;    }#wrapper    .form-container        div            form#add_form(action='', method='post')                p.legend                    strong 注意:带                        em *                        |号的为必填字段！                fieldset#selectWarehouse                    legend                    div                        input(type='hidden', name='_csrf', value='#{csrf}')                        input#save.btn(type='button', value=' 保 存 ')                        input#back_btn.btn(type='button', value=' 返 回 ', onclick='$.fancybox.close();')                //选择进货的目的仓库                fieldset#selectGoodsType                    legend 进货目的仓库                    div                        label  仓库选择：                        select#recipient_id.allowInput(name='recipient_id')                //选择供货商                fieldset#selectSupplier                    legend 供货商                    div                        label  供货商选择：                        select#supplier_id.allowInput(name='supplier_id')                            option(value="0") 泛盈科技虚拟供货商                //选择商品类型                fieldset#showGoods                    legend(style='color: #C00; font-style: normal;') 商品选择                    div                        table(border = "1", width="100%")                            tr(width="30%")                                td 类型选择                                td 商品列表                            tr(width="70%")                                td                                    #menuContent.menuContent(style='display:none; position: absolute;background-color:#CCC')                                    ul#treeDemo.ztree(style="margin-top:0; ")                                    input#type_id.allowInput(type='hidden', name='type_id', value='')                                td                                    table#list                                        #pager                //显示已选商品列表                fieldset#selectedGoods                    legend(style='color: #C00; font-style: normal;') 已选商品列表                    div                        #container(align="left")                            #demo                                table(cellpadding="5", cellspacing="0", border="1", class="display", id="example", align="center")                                    thead                                        tr.title                                            th 银行名称                                            th 提现支出                                            th 转存收入                                            th 状态                                            th 对账结束                                            th 操作                                    tbody                                        tr.gradeX                                            td 中国工商银行1                                            td.orange 100                                            td 200                                            td.orange 已对                                            td 平                                            td.orange                                                a(href="query-c1.html",target="_parent")删除                                        tr.gradeB                                            td 中国工商银行2                                            td.orange 22                                            td 201                                            td.orange 已对2                                            td 平2                                            td.orange                                                a(href="query-c1.html",target="_parent")删除                fieldset#selectedGoods                    legend(style='color: #C00; font-style: normal;') 其他信息                    div                        label  员工流水号：                        input(type='text', name='_id', value='#{locals.member?member._id:''}',readonly)                    div                        label  会员流水号：                        input#user_id.allowUserInput(type='text', name='user_id', value='#{locals.member?member.user_id:''}', readonly)                    div#cellphone_div                        label  手机号码：                        input#cellphone.allowInput(type='text', name='cellphone', value='#{locals.user?user.cellphone:''}', readonly)                    div                        label.error  昵称：                        input#pet_name.allowInput(type='text', name='pet_name', value='#{locals.member?member.pet_name:''}')                    div                        label  生日：                        input#birthday.allowUserInput(type='text', name='birthday', value='#{locals.user?user.birthday:''}', readonly)                    div                        label  创建时间：                        input#create_time.allowInput(type='text', name='create_time', value='#{locals.member?member.create_time:''}', readonly)                    div                        label  到期时间：                        input#due_time.allowInput(type='text', name='due_time', value='#{locals.member?member.due_time:''}', readonly)script(type='text/javascript')    //设置前台页面显示的表格列头    var colNames = ['编号', '名称', '资产编号','商品类型','状态','售价','创建时间'];    //设置前台页面显示的表格数据    var colModel = [        {name:'_id',index:'_id', width:100, align:"center",sortable:true},        {name:'name',index:'name', width:200, align:"center",sortable:true},        {name:'code',index:'code', width:200,align:"center",sortable:true},        {name:'goods_type_name',index:'warehouse_id', width:200, align:"center",sortable:true},        {name:'state',index:'state', width:150, align:"center",sortable:true,formatter:'select', editoptions:{value:"0:下架;1:上架"}},        {name:'price',index:'price', width:200, align:"center",sortable:true},        {name:'create_time',index:'create_time', width:300, align:"center",sortable:true,            formatter : 'date', formatoptions : {srcformat : 'Y-m-d',newformat : 'Y-m-d'}        }];    $(document).ready(function(){        //页面初始化        initWarehouses();        initGoodsTypeTree();    });    $("#back_btn").click(function(){        window.location.href='/warehouse_warrant';    });    $(function(){        jQuery("#list").jqGrid({            url:'/goods/index?isWeb=1',            datatype: "json",            mtype: 'GET',            colNames:colNames,            colModel:colModel,            gridview:true, //加速显示            multiselect: true,  //可多选，出现多选框            multiselectWidth: 25, //设置多选列宽度            rowNum:10,            rowList:[10,20,30],            pager: '#pager',            sortname: 'create_time',            sortorder:'desc',            viewrecords: true,            caption:"商品列表",            autowidth: true, //自动匹配宽度            height: 300,            prmNames : {                rows:"limit" // 表示请求行数的参数名称            },            loadComplete:function(data){ //完成服务器请求后，回调函数                console.log(data);                if(data.records == undefined || data.records == 0){ //如果没有记录返回，追加提示信息，删除按钮不可用                    $("p").appendTo($("#list")).addClass("nodata").html('找不到相关数据！');                    $("#del_btn").attr("disabled",true);                }else{ //否则，删除提示，删除按钮可用                    $("p.nodata").remove();                    $("#del_btn").removeAttr("disabled");                }            },            loadError:function(xhr,status,error){                $("p").appendTo($("#list")).addClass("nodata").html('查询数据出错！');                $("#del_btn").attr("disabled",true);            }        });        //日期控件        $("#due_time").datepicker({            dateFormat: 'yy-mm-dd',            changeMonth: true,            changeYear: true,            showOn: "button",            buttonImage: "/images/calendar.gif",            buttonImageOnly: true        });        $("#birthday").datepicker({            dateFormat: 'yy-mm-dd',            changeMonth: true,            changeYear: true,            showOn: "button",            buttonImage: "/images/calendar.gif",            buttonImageOnly: true        });        //提交表单参数设定        $('#add_form').ajaxForm({            beforeSubmit: validate,            success: function(result){                if(200 == result.status){                    $().message("成功添加");                    $("#list").trigger("reloadGrid", [{current:true}]);                }else{                    $().message("添加失败:"+result.error);                }            }        });        //提交前校验        function validate(formData, jqForm, options) {            var pet_name = $("#pet_name").attr("value");            var due_time = $("#due_time").attr("value");            if(!pet_name || pet_name.trim() == ""){                $().message("<b>请输入'昵称'！</b>");                return false;            }else if(!due_time || due_time.trim() == ""){                $().message("<b>请输入'到期时间'！</b>");                return false;            }else{                $.fancybox.close();//为防止因为网络延时造成对话框不关闭，再次输入，提前关闭对话框。                $().message("正在提交...");            }        };    });    //提交表单进行保存    $("#save").click(function(){        $('#add_form').submit();    });    function initWarehouses(){        $.ajax({            type: "Get",            url: '/warehouse',            dataType: "json",            global: false,            async: false,            success: function (result) {                console.log(JSON.stringify(result));                if(result.length){                    for(var i = 0; i < result.length; i++){                        $("#recipient_id").append("<option value='"+result[i]._id+"'>"+result[i].name+"</option>");                    }                }            },            error: function () {                alert("Ajax请求数据失败!");            }        });    };    //页面初始化时调用，设置按钮显示，输入框是否只读等属性。    function initGoodsTypeTree(){        var zTree;        var zNodes;//保存树节点的json对象        var setting = {            async: {                enable: true,                type:"get",                dataType:"text",                contentType:"application/json",                url:"/goods/type",                autoParam:["_id", "name"],                otherParam:{"otherParam":""},//可以传参，暂未使用                dataFilter: filter            },            view: {                dblClickExpand: false,                showLine: true,                selectedMulti: false,                expandSpeed: ($.browser.msie && parseInt($.browser.version)<=6)?"":"fast"            },            data: {                simpleData: {                    enable:true,                    idKey: "_id",                    pIdKey: "parent_id",                    rootPId: ""                }            },            callback: {                beforeClick: beforeClick,                onClick: onClick            }        };        function filter(treeId, parentNode, childNodes) {                if (!childNodes) return null;                for (var i=0, l=childNodes.length; i<l; i++) {                    childNodes[i].name = childNodes[i].name.replace(/\.n/g, '.');                }                return childNodes;            };        function beforeClick(treeId, treeNode) {            //var check = (treeNode && !treeNode.isParent);            //if (!check) alert("只能选择叶子节点...");            //return check;            return true;        }        function onClick(e, treeId, treeNode) {            zTree = $.fn.zTree.getZTreeObj("treeDemo"),            nodes = zTree.getSelectedNodes(),            v = "";            _id = "";            //nodes.sort(function compare(a,b){return a.id-b.id;});            if(nodes.length){                v = nodes[0].name;                _id = nodes[0]._id;            }            //if (v.length > 0 ) v = v.substring(0, v.length-1);            var type_id = $("#type_id");            var type_name = $("#type_name");            type_id.attr("value", _id);            type_name.attr("value", v);            hideMenu();        }        function showMenu() {            var myObj = $("#type_name");            var myOffset = $("#type_name").offset();            var dialogOffset = $("#fancybox-inner").offset();            var left = myOffset.left - dialogOffset.left;            var top = myOffset.top - dialogOffset.top;            $("#menuContent").css({left:left + "px", top:top + myObj.outerHeight() + "px"}).slideDown("fast");            $("body").bind("mousedown", onBodyDown);        }        function hideMenu() {            $("#menuContent").fadeOut("fast");            $("body").unbind("mousedown", onBodyDown);        }        function onBodyDown(event) {            if (!(event.target.id == "menuBtn" || event.target.id == "menuContent" || $(event.target).parents("#menuContent").length>0)) {                hideMenu();            }        }        $.ajax({            type: "Get",            url: '/goods/type',            dataType: "text",            global: false,            async: false,            success: function (strReult) {                zNodes=eval(strReult);            },            error: function () {                alert("Ajax请求数据失败!");            }        });        var t = $("#treeDemo");        t = $.fn.zTree.init(t, setting, zNodes);    };