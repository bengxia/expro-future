.fanboxlink(rel='stylesheet', type='text/css', href='/libs/JQuery_zTree_v3.2/css/zTreeStyle/zTreeStyle.css', media='screen')script(type='text/javascript', src='/libs/JQuery_zTree_v3.2/js/jquery.ztree.core-3.2.js')brbr#wrapper    .form-container        form#add_form(action='', method='post')            p.legend                strong 注意:带                    em *                    |号的为必填字段！            fieldset#selectWarehouse                legend                div                    input(type='hidden', name='_csrf', value='#{csrf}')                    input#save.btn(type='button', value=' 保 存 ')                    input#back_btn.btn(type='button', value=' 返 回 ', onclick='$.fancybox.close();')            //选择进货的目的仓库            fieldset#selectGoodsType                legend 进货目的仓库                div                    label  手机号码：                    input#cellphoneFirst.allowInput(type='text', name='cellphoneFirst')                div                    label  请点击‘下一步’：                    input#cellphoneNextBt.btn(type='button', value=' 下一步 ')            //选择商品类型            fieldset#showGoods                legend(style='color: #C00; font-style: normal;') 商品选择（1、类型选择；2、商品选择）                div                    input#type_id.allowInput(type='hidden', name='type_id', value='#{locals.goods?goods.type_id:''}')                    input#type_name.allowInput(type='text', name='type_name', value='#{locals.goods?goods.goods_type_name:''}', disabled)                    a#menuBtn(href='#', onclick="showMenu(); return false;")选择商品类型                div                    label  商品选择Table：                    input#checkPasswordBt.btn(type='button', value=' 验证 ')            //显示已选商品列表            fieldset#selectedGoods                legend(style='color: #C00; font-style: normal;') 已选商品列表                div                    table(border = "1")                        tr                            td 操作                            td 商品名称                            td 商品代码                            td 销售单价                        tr                            td                                input(role="checkbox", type="checkbox", id="jqg_list_3", class="cbox", name="jqg_list_3")                            td                                Iphone4s-黑色-16g                            td                                001002                            td                                4999.00            fieldset#selectedGoods                legend(style='color: #C00; font-style: normal;') 员工信息                div                    label  员工流水号：                    input(type='text', name='_id', value='#{locals.member?member._id:''}',readonly)                div                    label  会员流水号：                    input#user_id.allowUserInput(type='text', name='user_id', value='#{locals.member?member.user_id:''}', readonly)                div#cellphone_div                    label  手机号码：                    input#cellphone.allowInput(type='text', name='cellphone', value='#{locals.user?user.cellphone:''}', readonly)                div                    label.error  昵称：                    input#pet_name.allowInput(type='text', name='pet_name', value='#{locals.member?member.pet_name:''}')                div                    label  生日：                    input#birthday.allowUserInput(type='text', name='birthday', value='#{locals.user?user.birthday:''}', readonly)                div                    label  创建时间：                    input#create_time.allowInput(type='text', name='create_time', value='#{locals.member?member.create_time:''}', readonly)                div                    label  到期时间：                    input#due_time.allowInput(type='text', name='due_time', value='#{locals.member?member.due_time:''}', readonly)script(type='text/javascript')    $(document).ready(function(){        //页面初始化        initGoodsTypeTree();    });    $("#back_btn").click(function(){        window.location.href='/warehouse_warrant';    });    $(function(){        //日期控件        $("#due_time").datepicker({            dateFormat: 'yy-mm-dd',            changeMonth: true,            changeYear: true,            showOn: "button",            buttonImage: "/images/calendar.gif",            buttonImageOnly: true        });        $("#birthday").datepicker({            dateFormat: 'yy-mm-dd',            changeMonth: true,            changeYear: true,            showOn: "button",            buttonImage: "/images/calendar.gif",            buttonImageOnly: true        });        //提交表单参数设定        $('#add_form').ajaxForm({            beforeSubmit: validate,            success: function(result){                if(200 == result.status){                    $().message("成功添加");                    $("#list").trigger("reloadGrid", [{current:true}]);                }else{                    $().message("添加失败:"+result.error);                }            }        });        //提交前校验        function validate(formData, jqForm, options) {            var pet_name = $("#pet_name").attr("value");            var due_time = $("#due_time").attr("value");            if(!pet_name || pet_name.trim() == ""){                $().message("<b>请输入'昵称'！</b>");                return false;            }else if(!due_time || due_time.trim() == ""){                $().message("<b>请输入'到期时间'！</b>");                return false;            }else{                $.fancybox.close();//为防止因为网络延时造成对话框不关闭，再次输入，提前关闭对话框。                $().message("正在提交...");            }        };    });    //提交表单进行保存    $("#save").click(function(){        $('#add_form').submit();    });    //页面初始化时调用，设置按钮显示，输入框是否只读等属性。    function initGoodsTypeTree(){        var zTree;        var zNodes;//保存树节点的json对象        var setting = {            async: {                enable: true,                type:"get",                dataType:"text",                contentType:"application/json",                url:"/goods/type",                autoParam:["_id", "name"],                otherParam:{"otherParam":""},//可以传参，暂未使用                dataFilter: filter            },            view: {                dblClickExpand: false,                showLine: true,                selectedMulti: false,                expandSpeed: ($.browser.msie && parseInt($.browser.version)<=6)?"":"fast"            },            data: {                simpleData: {                    enable:true,                    idKey: "_id",                    pIdKey: "parent_id",                    rootPId: ""                }            },            callback: {                beforeClick: beforeClick,                onClick: onClick            }        };        function filter(treeId, parentNode, childNodes) {                if (!childNodes) return null;                for (var i=0, l=childNodes.length; i<l; i++) {                    childNodes[i].name = childNodes[i].name.replace(/\.n/g, '.');                }                return childNodes;            };        function beforeClick(treeId, treeNode) {            //var check = (treeNode && !treeNode.isParent);            //if (!check) alert("只能选择叶子节点...");            //return check;            return true;        }        function onClick(e, treeId, treeNode) {            zTree = $.fn.zTree.getZTreeObj("treeDemo"),            nodes = zTree.getSelectedNodes(),            v = "";            _id = "";            //nodes.sort(function compare(a,b){return a.id-b.id;});            if(nodes.length){                v = nodes[0].name;                _id = nodes[0]._id;            }            //if (v.length > 0 ) v = v.substring(0, v.length-1);            var type_id = $("#type_id");            var type_name = $("#type_name");            type_id.attr("value", _id);            type_name.attr("value", v);            hideMenu();        }        function showMenu() {            var myObj = $("#type_name");            var myOffset = $("#type_name").offset();            var dialogOffset = $("#fancybox-inner").offset();            var left = myOffset.left - dialogOffset.left;            var top = myOffset.top - dialogOffset.top;            $("#menuContent").css({left:left + "px", top:top + myObj.outerHeight() + "px"}).slideDown("fast");            $("body").bind("mousedown", onBodyDown);        }        function hideMenu() {            $("#menuContent").fadeOut("fast");            $("body").unbind("mousedown", onBodyDown);        }        function onBodyDown(event) {            if (!(event.target.id == "menuBtn" || event.target.id == "menuContent" || $(event.target).parents("#menuContent").length>0)) {                hideMenu();            }        }        $.ajax({            type: "Get",            url: '/goods/type',            dataType: "text",            global: false,            async: false,            success: function (strReult) {                zNodes=eval(strReult);            },            error: function () {                alert("Ajax请求数据失败!");            }        });        var t = $("#treeDemo");        t = $.fn.zTree.init(t, setting, zNodes);    };