//以下是JQuery ui的jsscript(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.core.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.widget.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.datepicker.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.button.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.draggable.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.mouse.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.position.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.resizable.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui/jquery.ui.dialog.js')script(type='text/javascript', src='/libs/jquery-jquery-ui-c1dc191/ui//i18n/jquery.ui.datepicker-zh-CN.js')//以下是一个jqGrid+fancybox的解决方案js//script(type='text/javascript', src='/libs/jqGrid_fancybox/js/i18n/grid.locale-cn.js')//script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.jqGrid.min.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.fancybox.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.form.js')script(type='text/javascript', src='/libs/jqGrid_fancybox/js/jquery.message.js')//以下是Ztree的jslink(rel='stylesheet', type='text/css', href='/libs/JQuery_zTree_v3.2/css/zTreeStyle/zTreeStyle.css', media='screen')script(type='text/javascript', src='/libs/JQuery_zTree_v3.2/js/jquery.ztree.core-3.2.js')//新jqGrid版本script(type='text/javascript', src='/libs/jquery.jqGrid-4.4.0/js/i18n/grid.locale-cn.js')script(type='text/javascript', src='/libs/jquery.jqGrid-4.4.0/js/jquery.jqGrid.min.js')style    select, input[type="file"] {        height: 18px;        line-height: 28px;    }    #toolbar {        padding: 10px 4px;    }#wrapper    .form-container        div            form#add_form(action='', method='post')                p.legend                    strong 注意:带                        em *                        |号的为必填字段！                fieldset#selectWarehouse                    legend                    div                        input(type='hidden', name='_csrf', value='#{csrf}')                        input#save.btn(type='button', value=' 保 存 ')                        input#back_btn.btn(type='button', value=' 返 回 ', onclick='$.fancybox.close();')                //选择进货的目的仓库                fieldset#selectGoodsType                    legend(style='color: #C00; font-style: normal;') 选择目的仓库与供货商                    div                        table(border = "0", width="80%", align="center")                            tr                                td(align="center", width="30%")                                    div                                        label  仓库选择：                                        select#recipient_id.allowInput(name='recipient_id')                                td(align="center", width="30%")                                    div                                        label  供货商选择：                                        select#supplier_id.allowInput(name='supplier_id')                                            option(value="0") 泛盈科技虚拟供货商                //选择商品类型                fieldset#showGoods                    legend(style='color: #C00; font-style: normal;') 商品选择                    div.demo-description                        p                            1可以通过选择“显示所有商品”按钮及“选择商品类型”按钮筛选“待选商品列表”，“待选商品列表”中的商品通过“双击”可以置入“已选商品列表”。                        P                            2“已选商品列表”中的商品通过“双击”科技删除，“数量”单元格“单击”后可以输入数量。                    #toolbarDiv                        span#toolbar(class="ui-widget-header ui-corner-all")                            button#selAllTypeBt 显示所有商品                            button#openGoodsTypeDialogBt 选择商品类型                    #goodsTypeDialog(title='请选择商品类型')                        #menuContent.menuContent(style='display:none; position: absolute;background-color:#CCC')                        ul#treeDemo.ztree(style="margin-top:0; ")                        input#type_id.allowInput(type='hidden', name='type_id', value='')                    #tablesDiv                        br                        table(border = "0", width="100%")                            tr                                td(align="center", width="45%")                                    table#list                                        #pager                                td(align="center", width="10%")                                td(align="center", width="45%")                                    table#selectList                                        #selectPager                fieldset#selectedGoods                    legend 备注                    div(align="center")                        textarea#comment.allowInput(rows='7', cols='140', name='comment')script(type='text/javascript')    //设置前台页面显示的表格列头    var colNames = ['编号', '名称', '商品类型','状态','资产编号','售价','创建时间','备注'];    //设置前台页面显示的表格数据    var colModel = [        {name:'_id',index:'_id', width:100, align:"center",sortable:true, hidden:true},        {name:'name',index:'name', width:200, align:"center",sortable:true},        {name:'type_id',index:'type_id', width:200, align:"center",sortable:true, hidden:true},        {name:'state',index:'state', width:150, align:"center",sortable:true,formatter:'select', editoptions:{value:"0:下架;1:上架"}, hidden:true},        {name:'code',index:'code', width:200,align:"center",sortable:true, hidden:true},        {name:'price',index:'price', width:200, align:"center",sortable:true},        {name:'create_time',index:'create_time', width:300, align:"center",sortable:true,            formatter : 'date', formatoptions : {srcformat : 'Y-m-d',newformat : 'Y-m-d'}, hidden:true        },        {name:'comment',index:'comment', width:200, align:"left",sortable:true, hidden:true}];    ///////////////    //设置前台页面显示的表格列头    var colNamesSel = ['编号', '名称', '商品类型','状态','资产编号','售价','创建时间','数量','单价','总价'];    //设置前台页面显示的表格数据    var colModelSel = [        {name:'_id',index:'_id', width:100, align:"center",sortable:true, hidden:true},        {name:'name',index:'name', width:200, align:"center",sortable:true,summaryType:'count'},        {name:'type_id',index:'type_id', width:200, align:"center",sortable:true, hidden:true},        {name:'state',index:'state', width:150, align:"center",sortable:true,formatter:'select', editoptions:{value:"0:下架;1:上架"}, hidden:true},        {name:'code',index:'code', width:200,align:"center",sortable:true, hidden:true},        {name:'price',index:'price', width:200, align:"center",sortable:true},        {name:'create_time',index:'create_time', width:300, align:"center",sortable:true,            formatter : 'date', formatoptions : {srcformat : 'Y-m-d',newformat : 'Y-m-d'}, hidden:true        },        {name:'num',index:'num', width:200, align:"center",editable:true},        {name:'unit_cost',index:'unit_cost', width:200, align:"center",editable:true},        {name:'total_cost',index:'total_cost', width:200, align:"center",editable:true}        ];    $(document).ready(function(){        //页面初始化        initWarehouses();        initGoodsTypeTree();    });    $("#back_btn").click(function(){        window.location.href='/warehouse_warrant';    });    $(function(){        $.fx.speeds._default = 500;        $("#goodsTypeDialog").dialog({            autoOpen: false,            show: "blind",            hide: "explode"        });        $("#openGoodsTypeDialogBt").click(function(){            $("#goodsTypeDialog").dialog("open");            return false;        });        $( "#openGoodsTypeDialogBt" ).button();        $("#selAllTypeBt").click(function(){            var url = '/goods?isWeb=1';            $("#list").jqGrid('setGridParam', {url:url});            $("#list").trigger("reloadGrid");            return false;        });        $( "#selAllTypeBt" ).button();        jQuery("#list").jqGrid({            url:'/goods?isWeb=1',            datatype: "json",            mtype: 'GET',            colNames:colNames,            colModel:colModel,            gridview:true, //加速显示            multiselect: false,  //可多选，出现多选框            rownumbers:true,            rowNum:10,            rowList:[10,20,30],            pager: '#pager',            sortname: 'create_time',            sortorder:'desc',            viewrecords: true,            caption:"待选商品列表",            autowidth: true, //自动匹配宽度            height: 300,            prmNames : {                rows:"limit" // 表示请求行数的参数名称            },            loadComplete:function(data){ //完成服务器请求后，回调函数                console.log(data);                if(data.records == undefined || data.records == 0){ //如果没有记录返回，追加提示信息，删除按钮不可用                    $("p").appendTo($("#list")).addClass("nodata").html('找不到相关数据！');                    $("#del_btn").attr("disabled",true);                }else{ //否则，删除提示，删除按钮可用                    $("p.nodata").remove();                    $("#del_btn").removeAttr("disabled");                }            },            loadError:function(xhr,status,error){                $("p").appendTo($("#list")).addClass("nodata").html('查询数据出错！');                $("#del_btn").attr("disabled",true);            },            ondblClickRow:function(rowid,iRow,iCol,e){                var arrIds = jQuery("#selectList").jqGrid('getDataIDs');                if(arrIds.indexOf(rowid) < 0){                    jQuery('#selectList').jqGrid('addRowData', rowid, $("#list").jqGrid('getRowData', rowid), 'last')                }            }        });        jQuery("#selectList").jqGrid({            url:'local',            colNames:colNamesSel,            colModel:colModelSel,            //gridview:true, //加速显示            rownumbers:true,            rowNum:10,            rowList:[10,20,30],            pager: '#selectPager',            sortname: 'create_time',            sortorder:'desc',            viewrecords: true,            emptyrecords:"请选择商品。",            caption:"已选商品列表",            autowidth: true, //自动匹配宽度            height:300,            forceFit:true,            cellEdit:true,            footerrow:true,            userDataOnFooter:true,            cellsubmit: 'clientArray',  //确定Cell Editing模式下，内容保存到远程服务器还是本地数组。'remote' 或者 'clientArray'。            afterInsertRow:function(rowid, rowdata, rowelem){ //完成服务器请求后，回调函数                jQuery('#selectList').jqGrid('footerData', 'set',                        {_id:'222', name:"汇总2", type_id:"22",state:"1", code:"11", price:"111", create_time:"", num:"", unit_cost:"", total_cost:""});            },            loadError:function(xhr,status,error){            },            ondblClickRow:function(rowid,iRow,iCol,e){                jQuery('#selectList').jqGrid('delRowData', rowid);                jQuery('#selectList').jqGrid('footerData', 'set',                    {_id:'111', name:"汇总", type_id:"22",state:"1", code:"11", price:"111", create_time:"", num:"", unit_cost:"", total_cost:""});            }        });        //提交表单参数设定        $('#add_form').ajaxForm({            beforeSubmit: validate,            success: function(result){                if(200 == result.status){                    $().message("成功添加");                    $("#list").trigger("reloadGrid", [{current:true}]);                }else{                    $().message("添加失败:"+result.error);                }            }        });        //提交前校验        function validate(formData, jqForm, options) {            var pet_name = $("#pet_name").attr("value");            var due_time = $("#due_time").attr("value");            if(!pet_name || pet_name.trim() == ""){                $().message("<b>请输入'昵称'！</b>");                return false;            }else if(!due_time || due_time.trim() == ""){                $().message("<b>请输入'到期时间'！</b>");                return false;            }else{                $.fancybox.close();//为防止因为网络延时造成对话框不关闭，再次输入，提前关闭对话框。                $().message("正在提交...");            }        };    });    //提交表单进行保存    $("#save").click(function(){        //$('#add_form').submit();        var jsonData = [{'sex':'A','name':'n','age':'18'},{'sex':'B','name':'nc','age':'18'},{'sex':'c','name':'na','age':'18'},{'sex':'d','name':'na','age':'18'},{'sex':'f','name':'ssn'}];        $.post("2.php", {'data': jsondata},function(data){alert(data)});    });    function initWarehouses(){        $.ajax({            type: "Get",            url: '/warehouse',            dataType: "json",            global: false,            async: false,            success: function (result) {                console.log(JSON.stringify(result));                if(result.length){                    for(var i = 0; i < result.length; i++){                        $("#recipient_id").append("<option value='"+result[i]._id+"'>"+result[i].name+"</option>");                    }                }            },            error: function () {                alert("Ajax请求数据失败!");            }        });    };    //页面初始化时调用，设置按钮显示，输入框是否只读等属性。    function initGoodsTypeTree(){        var zTree;        var zNodes;//保存树节点的json对象        var setting = {            async: {                enable: true,                type:"get",                dataType:"text",                contentType:"application/json",                url:"/goods/type",                autoParam:["_id", "name"],                otherParam:{"otherParam":""},//可以传参，暂未使用                dataFilter: filter            },            view: {                dblClickExpand: false,                showLine: true,                selectedMulti: false,                expandSpeed: ($.browser.msie && parseInt($.browser.version)<=6)?"":"fast"            },            data: {                simpleData: {                    enable:true,                    idKey: "_id",                    pIdKey: "parent_id",                    rootPId: ""                }            },            callback: {                beforeClick: beforeClick,                onClick: onClick            }        };        function filter(treeId, parentNode, childNodes) {                if (!childNodes) return null;                for (var i=0, l=childNodes.length; i<l; i++) {                    childNodes[i].name = childNodes[i].name.replace(/\.n/g, '.');                }                return childNodes;            };        function beforeClick(treeId, treeNode) {            //var check = (treeNode && !treeNode.isParent);            //if (!check) alert("只能选择叶子节点...");            //return check;            return true;        }        function onClick(e, treeId, treeNode) {            zTree = $.fn.zTree.getZTreeObj("treeDemo"),            nodes = zTree.getSelectedNodes(),            v = "";            _id = "";            //nodes.sort(function compare(a,b){return a.id-b.id;});            if(nodes.length){                v = nodes[0].name;                _id = nodes[0]._id;            }            var url = '/goods?isWeb=1&type_id='+_id;            $("#list").jqGrid('setGridParam', {url:url});            $("#list").trigger("reloadGrid");        }        $.ajax({            type: "Get",            url: '/goods/type',            dataType: "text",            global: false,            async: false,            success: function (strReult) {                zNodes=eval(strReult);            },            error: function () {                alert("Ajax请求数据失败!");            }        });        var t = $("#treeDemo");        t = $.fn.zTree.init(t, setting, zNodes);    };